<html>
<head>
	<script>
		var nodelist = ['DIV', 'TABLE', 'FORM', 'UL', 'OL', 'SPAN', 'NOSCRIPT'];
		var structureNodes = new Array();
		for(var i=0; i<nodelist.length; i++) {
			structureNodes[nodelist[i]] = 1;
		}
		
		
		var struct = new Array();
		var div = document.createElement('div');
		function run(){
			chrome.extension.onRequest.addListener(function(request, sender, sendResponse){
				div.innerHTML = request.body.replace(/<script(.|\s)*?\/script>|<style(.|\s)*?\/style>/g, '');
				struct[request.url] = new Array();
				examineNode(request.url, div);
			});
		}
		
		
		// Assumes this is a structure node (initially called on a div)
		function examineNode(url, node) {
			var rest = "";
			for (var i = 0, l = node.childNodes.length; i < l; i++) {
				var child = node.childNodes[i];
				if (structureNodes[child.nodeName] == 1) examineNode(url, child);
				else if(child.innerText != null) rest += child.innerText + " ";
			}
			if(rest != "") struct[url].push(rest);
		}
	</script>
</head>
<body onload="run();">
</body>
</html>